/*! odba-core - 0.2.0 (2014-12-19) */!function(){function Combinator(){}function Connection(config){Object.defineProperty(this,"config",{value:config,enumerable:!0})}function Database(){}function Driver(name){Object.defineProperty(this,"name",{value:name,enumerable:!0})}function Index(){}function Query(){}function Result(rows){Object.defineProperty(this,"rows",{value:rows})}function ResultFilter(){}function Server(){}function Table(){}Combinator.prototype.join=function(source,target,sourceCol,targetCol,opts){var arrayAgg,res=[],util=odba.util;arrayAgg=opts.arrayAgg;for(var i=0;i<source.length;++i){for(var srcRow=util._extend({},source[i]),arrAgg=srcRow[arrayAgg]=[],j=0;j<target.length;++j){var tgtRow=util._extend(target[j]);srcRow[sourceCol]==tgtRow[targetCol]&&arrAgg.push(tgtRow)}res.push(srcRow)}return res},Connection.prototype.clone=function(){throw new Error("Abstract method.")},Connection.prototype.__defineGetter__("connected",function(){throw new Error("Abstract property.")}),Connection.prototype.__defineGetter__("server",function(){throw new Error("Abstract property.")}),Connection.prototype.open=function(){throw new Error("Abstract method.")},Connection.prototype.close=function(){throw new Error("Abstract method.")},Connection.prototype.runTransaction=function(){throw new Error("Abstract method.")},Database.prototype.__defineGetter__("name",function(){throw new Error("Abstract property.")}),Database.prototype.hasTable=function(){throw new Error("Abstract method.")},Database.prototype.hasTables=function(){throw new Error("Abstract method.")},Database.prototype.findTable=function(){throw new Error("Abstract method.")},Database.prototype.createTable=function(){throw new Error("Abstract method.")},Database.prototype.createTables=function(){throw new Error("Abstract method.")},Database.prototype.dropTable=function(){throw new Error("Abstract method.")},Database.prototype.findIndex=function(){throw new Error("Abstract method.")},Database.prototype.hasIndex=function(){throw new Error("Abstract method.")},Database.prototype.createIndex=function(){throw new Error("Abstract method.")},Database.prototype.dropIndex=function(){throw new Error("Abstract method.")},Driver.getDriver=function(name){var cache,drv;return"cache"in this||Object.defineProperty(this,"cache",{value:{}}),cache=this.cache,name=name.toLowerCase(),drv=cache[name],drv||"indexeddb"==name&&(drv=cache.indexeddb=new odba.indexeddb.IndexedDBDriver),drv},Driver.prototype.createConnection=function(){throw new Error("Abstract method.")},Driver.prototype.openConnection=function(){throw new Error("Abstract method.")},Index.prototype.__defineGetter__("database",function(){throw new Error("Abstract property.")}),Index.prototype.__defineGetter__("table",function(){throw new Error("Abstract property.")}),Index.prototype.__defineGetter__("name",function(){throw new Error("Abstract property.")}),Index.prototype.__defineGetter__("unique",function(){throw new Error("Abstract property.")}),Query.prototype.findAll=function(){throw new Error("Abstract method.")},Query.prototype.find=function(){throw new Error("Abstract method.")},Query.prototype.findOne=function(){throw new Error("Abstract method.")},Query.prototype.join=function(){throw new Error("Abstract method.")},Result.prototype.__defineGetter__("length",function(){return this.rows.length}),Result.prototype.find=function(where){return(new odba.ResultFilter).find(this,where)},ResultFilter.prototype.find=function(result,filter){var filtered=[];filter||(filter={});for(var i=0,rows=result.rows;i<result.length;++i){var row=rows[i];this.check(row,filter)&&filtered.push(row)}return filtered},ResultFilter.prototype.check=function(row,filter){var res=!1,keys=Object.keys(filter);if(0===keys.length)res=!0;else if(1==keys.length)res=this.checkProp(row,keys[0],filter);else{res=!0;for(var i=0,props=keys;i<props.length;++i){var prop=props[i];if(!this.checkProp(row,prop,filter)){res=!1;break}}}return res},ResultFilter.prototype.checkProp=function(row,prop,filter){var res;if(filter=filter[prop],"object"!=typeof filter)res=this.$eq(row,prop,filter);else{var ops=Object.keys(filter);if(0===ops.length)res=!0;else if(1==ops.length)res=this.checkOp(row,prop,ops[0],filter);else{res=!0;for(var i=0;i<ops.length;++i)if(!this.checkOp(row,prop,ops[i],filter)){res=!1;break}}}return res},ResultFilter.prototype.checkOp=function(row,prop,op,filter){var res;if("$eq"==op)res=this.$eq(row,prop,filter.$eq);else if("$ne"==op)res=this.$ne(row,prop,filter.$ne);else if("$lt"==op)res=this.$lt(row,prop,filter.$lt);else if("$le"==op)res=this.$le(row,prop,filter.$le);else if("$gt"==op)res=this.$gt(row,prop,filter.$gt);else if("$ge"==op)res=this.$ge(row,prop,filter.$ge);else if("$like"==op)res=this.$like(row,prop,filter.$like);else if("$notLike"==op)res=this.$notLike(row,prop,filter.$notLike);else if("$in"==op)res=this.$in(row,prop,filter.$in);else{if("$notIn"!=op)throw new Error("Unknown operator: '"+op+"'.");res=this.$notIn(row,prop,filter.$notIn)}return res},ResultFilter.prototype.$eq=function(row,prop,value){return void 0===value?void 0===row[prop]:null===value?null===row[prop]:row[prop]==value},ResultFilter.prototype.$ne=function(row,prop,value){return void 0===value?void 0!==row[prop]:null===value?null!==row[prop]:row[prop]!=value},ResultFilter.prototype.$lt=function(row,prop,value){return void 0===value||null===value?!1:row[prop]<value},ResultFilter.prototype.$le=function(row,prop,value){return void 0===value||null===value?!1:row[prop]<=value},ResultFilter.prototype.$gt=function(row,prop,value){return void 0===value||null===value?!1:row[prop]>value},ResultFilter.prototype.$ge=function(row,prop,value){return void 0===value||null===value?!1:row[prop]>=value},ResultFilter.prototype.$like=function(row,prop,value){return void 0===value||null===value?this.$eq(row,prop,value):new RegExp(value).test(row[prop])},ResultFilter.prototype.$notLike=function(row,prop,value){return void 0===value||null===value?this.$ne(row,prop,value):!this.$like(row,prop,value)},ResultFilter.prototype.$in=function(row,prop,value){return void 0===value||null===value?!1:value.indexOf(row[prop])>=0},ResultFilter.prototype.$notIn=function(row,prop,value){return!this.$in(row,prop,value)},Server.prototype.__defineGetter__("host",function(){throw new Error("Abstract method.")}),Server.prototype.__defineGetter__("port",function(){throw new Error("Abstract method.")}),Server.prototype.__defineGetter__("version",function(){throw new Error("Abstract method.")}),Table.prototype.__defineGetter__("database",function(){throw new Error("Abstract method.")}),Table.prototype.__defineGetter__("name",function(){throw new Error("Abstract method.")}),Table.prototype.hasIndex=function(name,callback){if(arguments.length<2)throw new Error("Index name and callback expected.");this.database.hasIndex(this.name,name,callback)},Table.prototype.findIndex=function(name,callback){if(arguments.length<2)throw new Error("Index name and callback expected.");this.database.findIndex(this.name,name,callback)},Table.prototype.createIndex=function(name,col,options,callback){if(arguments.length<2)throw new Error("Index name and indexing column expected.");3==arguments.length&&arguments[2]instanceof Function&&(callback=arguments[2],options={}),this.database.createIndex(this.name,name,col,options,callback)},Table.prototype.dropIndex=function(name,callback){if(arguments.length<1)throw new Error("Index name expected.");this.database.dropIndex(this.name,name,callback)},Table.prototype.find=function(){throw new Error("Abstract method.")},Table.prototype.findAll=function(){throw new Error("Abstract method.")},Table.prototype.findOne=function(){throw new Error("Abstract method.")},Table.prototype.count=function(){throw new Error("Abstract method.")},Table.prototype.join=function(){throw new Error("Abstract method.")},Table.prototype.insert=function(){throw new Error("Abstract method.")},Table.prototype.save=function(){throw new Error("Abstract method.")},Table.prototype.update=function(){throw new Error("Abstract method.")},Table.prototype.remove=function(){throw new Error("Abstract method.")},Object.defineProperty(window,"odba",{value:{},enumerable:!0}),Object.defineProperty(odba,"util",{value:{inherits:function(child,parent){child.super_=parent,child.prototype=Object.create(parent.prototype,{constructor:{value:child,enumerable:!1,writable:!0,configurable:!0}})},_extend:function(origin,add){if("object"==typeof add)for(var i=0,keys=Object.keys(add);i<keys.length;++i){var k=keys[i];origin[k]=add[k]}return origin},getBrowserName:function(){return window.chrome?"Chrome":"Other"}}}),Object.defineProperty(odba,"Combinator",{value:Combinator,enumerable:!0}),Object.defineProperty(odba,"Connection",{value:Connection,enumerable:!0}),Object.defineProperty(odba,"Database",{value:Database,enumerable:!0}),Object.defineProperty(odba,"Driver",{value:Driver,enumerable:!0}),Object.defineProperty(odba,"Index",{value:Index,enumerable:!0}),Object.defineProperty(odba,"Query",{value:Query,enumerable:!0}),Object.defineProperty(odba,"Result",{value:Result,enumerable:!0}),Object.defineProperty(odba,"ResultFilter",{value:ResultFilter,enumerable:!0}),Object.defineProperty(odba,"Server",{value:Server,enumerable:!0}),Object.defineProperty(odba,"Table",{value:Table,enumerable:!0})}();