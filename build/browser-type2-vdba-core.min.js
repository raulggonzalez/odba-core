/*! vdba-core - 0.12.0 (2015-01-13) */!function(){function AggOperation(op,column,alias,filter){Object.defineProperty(this,"name",{value:op,enumerable:!0}),Object.defineProperty(this,"column",{value:column,enumerable:!0}),Object.defineProperty(this,"alias",{value:alias,enumerable:!0}),Object.defineProperty(this,"filter",{value:filter,enumerable:!0})}function Aggregator(){}function Column(name,type,options){if(!name)throw new Error("Column name expected.");if(!type)throw new Error("Column type expected.");options||(options={}),Object.defineProperty(this,"name",{value:name,enumerable:!0}),Object.defineProperty(this,"type",{value:type,enumerable:!0}),Object.defineProperty(this,"options",{value:options,enumerable:!0})}function Combinator(){}function Connection(driver,config){Object.defineProperty(this,"driver",{value:driver}),Object.defineProperty(this,"config",{value:config})}function Database(cx,name){if(!name)throw new Error("Database name expected.");Object.defineProperty(this,"connection",{value:cx}),Object.defineProperty(this,"name",{value:name.toLowerCase(),enumerable:!0}),Object.defineProperty(this,"definitionCache",{value:new vdba.DefinitionCache})}function DefinitionCache(){Object.defineProperty(this,"schemas",{value:{},configurable:!0})}function Driver(name,aliases){"string"==typeof aliases?aliases=[aliases]:aliases||(aliases=[]),Object.defineProperty(this,"name",{value:name,enumerable:!0}),Object.defineProperty(this,"aliases",{value:aliases,enumerable:!0})}function Filter(){}function GroupBy(columns){"string"==typeof columns&&(columns=[columns]),Object.defineProperty(this,"columns",{value:columns,enumerable:!0}),Object.defineProperty(this,"aggregations",{value:[],enumerable:!0})}function Index(table,name){Object.defineProperty(this,"table",{value:table,enumerable:!0}),Object.defineProperty(this,"name",{value:name,enumerable:!0})}function Join(type,mode,target,col1,col2){if(!type)throw new Error("Join type expected.");if(!mode)throw new Error("Join mode expected.");if(!target)throw new Error("Target table expected.");if(!col1)throw new Error("Source column name expected.");if(!col2)throw new Error("Target column name expected.");Object.defineProperty(this,"type",{value:type.toLowerCase(),enumerable:!0}),Object.defineProperty(this,"mode",{value:mode,enumerable:!0}),Object.defineProperty(this,"target",{value:target,enumerable:!0,writable:!0}),Object.defineProperty(this,"sourceColumn",{value:col1,enumerable:!0}),Object.defineProperty(this,"targetColumn",{value:col2,enumerable:!0})}function Mapper(){}function Query(){Object.defineProperty(this,"limitTo",{value:{count:void 0,start:0}}),Object.defineProperty(this,"filterBy",{value:{},writable:!0}),Object.defineProperty(this,"groupBy",{value:void 0,writable:!0}),Object.defineProperty(this,"orderBy",{value:{},writable:!0}),Object.defineProperty(this,"joins",{value:[]})}function Result(rows,options){Object.defineProperty(this,"rows",{value:rows}),Object.defineProperty(this,"options",{value:options||{}})}function Schema(db,name){if(!db)throw new Error("Database expected.");if(!name)throw new Error("Schema name expected.");Object.defineProperty(this,"database",{value:db,enumerable:!0}),Object.defineProperty(this,"name",{value:name.toLowerCase(),enumerable:!0})}function Server(){}function Table(schema,name,columns){if(!schema)throw new Error("Schema expected.");if(!name)throw new Error("Table name expected.");columns||(columns={}),Object.defineProperty(this,"schema",{value:schema,enumerable:!0}),Object.defineProperty(this,"name",{value:name.toLowerCase(),enumerable:!0}),Object.defineProperty(this,"columns",{value:columns,enumerable:!0})}AggOperation.prototype.hasFilter=function(){return!!this.filter},Aggregator.aggregator=new Aggregator,Aggregator.prototype.transform=function(object,columns,property){if(!object)throw new Error("Object to transform expected.");if(!columns)throw new Error("Column names to transform expected.");if(!property)throw new Error("Property name expected.");object instanceof vdba.Result?this.transformResult(object,columns,property):this.transformObject(object,columns,property)},Aggregator.prototype.transformObject=function(object,columns,property){var i,colNames,value={};if(columns instanceof Array)for(colNames=columns,columns={},i=0;i<colNames.length;++i)columns[colNames[i]]=!0;else colNames=Object.keys(columns);for(i=0;i<colNames.length;++i){var name=colNames[i],toDel=columns[name];object.hasOwnProperty(name)&&(value[name]=object[name]),toDel&&delete object[name]}0===Object.keys(value).length&&(value=void 0),object[property]=value},Aggregator.prototype.transformResult=function(result,columns,property){for(var i=0;i<result.length;++i)this.transformObject(result.rows[i],columns,property)},Column.prototype.__defineGetter__("nullable",function(){return!!this.options.nullable}),Column.prototype.__defineGetter__("primaryKey",function(){return!!this.options.primaryKey}),Column.prototype.__defineGetter__("pk",function(){return this.primaryKey}),Column.prototype.isSet=function(){return/^set<.+>$/.test(this.type)},Column.prototype.isSetOfIntegers=function(){return"set<integer>"==this.type},Column.prototype.isSetOfTexts=function(){return"set<text>"==this.type},Column.prototype.isBlob=function(){return"blob"==this.type},Column.prototype.isBoolean=function(){return"boolean"==this.type},Column.prototype.isDate=function(){return"date"==this.type},Column.prototype.isTime=function(){return"time"==this.type},Column.prototype.isDateTime=function(){return"datetime"==this.type},Column.prototype.isNumber=function(){return"integer"==this.type||"real"==this.type},Column.prototype.isInteger=function(){return"integer"==this.type},Column.prototype.isReal=function(){return"real"==this.type},Column.prototype.isText=function(){return"text"==this.type},Combinator.prototype.join=function(source,target,sourceCol,targetCol,opts){var arrayAgg,res=[],util=vdba.util;arrayAgg=opts.arrayAgg;for(var i=0;i<source.length;++i){for(var srcRow=util._extend({},source[i]),arrAgg=srcRow[arrayAgg]=[],j=0;j<target.length;++j){var tgtRow=util._extend(target[j]);srcRow[sourceCol]==tgtRow[targetCol]&&arrAgg.push(tgtRow)}res.push(srcRow)}return res},Connection.prototype.__defineGetter__("mode",function(){return this.config.mode}),Connection.prototype.clone=function(){throw new Error("Abstract method.")},Connection.prototype.__defineGetter__("connected",function(){throw new Error("Abstract property.")}),Connection.prototype.__defineGetter__("server",function(){throw new Error("Abstract property.")}),Connection.prototype.__defineGetter__("database",function(){throw new Error("Abstract property.")}),Connection.prototype.open=function(){throw new Error("Abstract method.")},Connection.prototype.close=function(){throw new Error("Abstract method.")},Connection.prototype.runTransaction=function(){throw new Error("Abstract method.")},Database.prototype.hasSchema=function(name,callback){if(!name)throw new Error("Schema name expected.");if(!callback)throw new Error("Callback expected.");this.findSchema(name,function(error,sch){error?callback(error):callback(void 0,!!sch)})},Database.prototype.findSchema=function(name,callback){var sch,self=this;if(!name)throw new Error("Schema name expected.");if(!callback)throw new Error("Callback expected.");sch=this.definitionCache.getSchema(name),sch?callback(void 0,sch):this.readSchema(name,function(error,sch){error?callback(error):(sch&&self.definitionCache.addSchema(sch),callback(void 0,sch))})},Database.prototype.readSchema=function(){throw new Error("Abstract method.")},Database.prototype.createSchema=function(){throw new Error("Abstract method.")},Database.prototype.dropSchema=function(){throw new Error("Abstract method.")},Database.prototype.hasTable=function(schema,table,columns,callback){if(3==arguments.length&&arguments[2]instanceof Function&&(callback=arguments[2],columns=void 0),!schema)throw new Error("Schema name expected.");if(!table)throw new Error("Table name expected.");if(!callback)throw new Error("Callback expected.");this.findTable(schema,table,function(error,tbl){error?callback(error):tbl?callback(void 0,columns?tbl.checkSchema(columns):!0):callback(void 0,!1)})},Database.prototype.hasTables=function(schema,tables,callback){function check(){i<tables.length?self.hasTable(schema,tables[i],function(error,exists){error?callback(error):exists?(++i,check()):callback(void 0,!1)}):callback(void 0,!0)}var i,self=this;if(!schema)throw new Error("Schema name expected.");if(!tables||tables instanceof Array&&0===tables.length)throw new Error("Table names expected.");if(!callback)throw new Error("Callback expected.");i=0,check()},Database.prototype.findTable=function(schema,table,callback){var tbl,self=this;if(!schema)throw new Error("Schema name expected.");if(!table)throw new Error("Table name expected.");if(!callback)throw new Error("Callback expected.");tbl=this.definitionCache.getTable(schema,table),tbl?callback(void 0,tbl):this.readTable(schema,table,function(error,tbl){error?callback(error):(tbl&&self.definitionCache.addTable(tbl),callback(void 0,tbl))})},Database.prototype.readTable=function(){throw new Error("Abstract method.")},Database.prototype.createTable=function(){throw new Error("Abstract method.")},Database.prototype.dropTable=function(){throw new Error("Abstract method.")},Database.prototype.findIndex=function(){throw new Error("Abstract method.")},Database.prototype.hasIndex=function(schema,index,callback){if(!schema)throw new Error("Schema expected.");if(!index)throw new Error("Index name expected.");if(!callback)throw new Error("Callback expected.");this.findIndex(schema,index,function(error,ix){error?callback(error):callback(void 0,!!ix)})},Database.prototype.createIndex=function(){throw new Error("Abstract method.")},Database.prototype.dropIndex=function(){throw new Error("Abstract method.")},DefinitionCache.SchemaItem=function(schema){Object.defineProperty(this,"schema",{value:schema}),Object.defineProperty(this,"tables",{value:{}})},DefinitionCache.prototype.hasSchema=function(schema){return!!this.schemas[schema]},DefinitionCache.prototype.getSchema=function(schema){var item;return item=this.schemas[schema],item&&(item=item.schema),item},DefinitionCache.prototype.addSchema=function(schema){return this.removeSchema(schema.name),this.schemas[schema.name]=new DefinitionCache.SchemaItem(schema)},DefinitionCache.prototype.removeSchema=function(schema){delete this.schemas[schema]},DefinitionCache.prototype.hasTable=function(schema,table){var item;return item=this.schemas[schema],item?!!item.tables[table]:!1},DefinitionCache.prototype.getTable=function(schema,table){var item;return item=this.schemas[schema],item&&(item=item.tables[table]),item},DefinitionCache.prototype.addTable=function(table){var schema;schema=this.schemas[table.schema.name],schema||(schema=this.addSchema(table.schema)),schema.tables[table.name]=table},DefinitionCache.prototype.removeTable=function(schema,table){var item;item=this.schemas[schema],item&&delete item.tables[table]},Object.defineProperty(Driver,"cache",{value:{}}),Driver.getDriver=function(name){var cache=vdba.Driver.cache;if(!name)throw new Error("Driver name expected.");return cache[name.toLowerCase()]},Driver.register=function(driver){var cache=vdba.Driver.cache;if(!driver)throw new Error("Driver expected.");cache[driver.name.toLowerCase()]=driver;for(var i=0,aliases=driver.aliases;i<aliases.length;++i)cache[aliases[i].toLowerCase()]=driver},Driver.prototype.createConnection=function(){throw new Error("Abstract method.")},Driver.prototype.openConnection=function(config,callback){var cx;if(!config)throw new Error("Configuration expected.");if(!callback)throw new Error("Callback expected.");cx=this.createConnection(config),cx.open(function(error){error?callback(error):callback(void 0,cx)})},Filter.filter=new Filter,Filter.prototype.filter=function(rows,filtr){filtr||(filtr={});for(var i=0;i<rows.length;++i)this.check(rows[i],filtr)||(rows.pop(i),--i);return rows},Filter.prototype.check=function(row,filter){var res=!1,keys=Object.keys(filter);if(0===keys.length)res=!0;else if(1==keys.length)res=this.checkProp(row,keys[0],filter);else{res=!0;for(var i=0,props=keys;i<props.length;++i){var prop=props[i];if(!this.checkProp(row,prop,filter)){res=!1;break}}}return res},Filter.prototype.checkProp=function(row,prop,filter){var res;if(filter=filter[prop],"object"!=typeof filter)res=this.$eq(row,prop,filter);else{var ops=Object.keys(filter);if(0===ops.length)res=!0;else if(1==ops.length)res=this.checkOp(row,prop,ops[0],filter);else{res=!0;for(var i=0;i<ops.length;++i)if(!this.checkOp(row,prop,ops[i],filter)){res=!1;break}}}return res},Filter.prototype.checkOp=function(row,prop,op,filter){var res;if("$eq"==op)res=this.$eq(row,prop,filter.$eq);else if("$ne"==op)res=this.$ne(row,prop,filter.$ne);else if("$lt"==op)res=this.$lt(row,prop,filter.$lt);else if("$le"==op)res=this.$le(row,prop,filter.$le);else if("$gt"==op)res=this.$gt(row,prop,filter.$gt);else if("$ge"==op)res=this.$ge(row,prop,filter.$ge);else if("$like"==op)res=this.$like(row,prop,filter.$like);else if("$notLike"==op)res=this.$notLike(row,prop,filter.$notLike);else if("$nlike"==op)res=this.$notLike(row,prop,filter.$nlike);else if("$in"==op)res=this.$in(row,prop,filter.$in);else if("$notIn"==op)res=this.$notIn(row,prop,filter.$notIn);else if("$nin"==op)res=this.$notIn(row,prop,filter.$nin);else if("$contains"==op)res=this.$contains(row,prop,filter.$contains);else if("$notContains"==op)res=this.$notContains(row,prop,filter.$notContains);else{if("$ncontains"!=op)throw new Error("Unknown operator: '"+op+"'.");res=this.$notContains(row,prop,filter.$ncontains)}return res},Filter.prototype.$eq=function(row,prop,value){return void 0===value?void 0===row[prop]:null===value?null===row[prop]:row[prop]==value},Filter.prototype.$ne=function(row,prop,value){return void 0===value?void 0!==row[prop]:null===value?null!==row[prop]:row[prop]!=value},Filter.prototype.$lt=function(row,prop,value){return void 0===value||null===value?!1:row[prop]<value},Filter.prototype.$le=function(row,prop,value){return void 0===value||null===value?!1:row[prop]<=value},Filter.prototype.$gt=function(row,prop,value){return void 0===value||null===value?!1:row[prop]>value},Filter.prototype.$ge=function(row,prop,value){return void 0===value||null===value?!1:row[prop]>=value},Filter.prototype.$like=function(row,prop,value){return void 0===value||null===value?this.$eq(row,prop,value):new RegExp(value).test(row[prop])},Filter.prototype.$notLike=function(row,prop,value){return void 0===value||null===value?this.$ne(row,prop,value):!this.$like(row,prop,value)},Filter.prototype.$in=function(row,prop,value){return void 0===value||null===value?!1:value.indexOf(row[prop])>=0},Filter.prototype.$notIn=function(row,prop,value){return!this.$in(row,prop,value)},Filter.prototype.$contains=function(row,prop,value){var res,arr;return arr=row[prop],res=arr instanceof Array?arr.indexOf(value)>0:"string"==typeof arr?arr.indexOf(value)>0:!1},Filter.prototype.$notContains=function(row,prop,value){return!this.$contains(row,prop,value)},GroupBy.prototype.add=function(agg){this.aggregations.push(agg)},GroupBy.prototype.hasFilter=function(){var res;res=!1;for(var i=0;i<this.aggregations.length;++i)if(this.aggregations[i].hasFilter()){res=!0;break}return res},GroupBy.prototype.__defineGetter__("filter",function(){for(var res={},i=0;i<this.aggregations.length;++i){var agg=this.aggregations[i];agg.hasFilter()&&(res[agg.alias]=agg.filter.value)}return res}),Index.prototype.__defineGetter__("database",function(){return this.table.database}),Index.prototype.__defineGetter__("unique",function(){throw new Error("Abstract property.")}),Mapper.mapper=new Mapper,Mapper.prototype.map=function(map,rows){for(var i=0;i<rows.length;++i)rows[i]=this.mapRow(map,rows[i]);return rows},Mapper.prototype.mapRow=function(map,row){var instance;return instance=map instanceof Function?this.customMap(map,row):map instanceof Array?this.defaultMap({map:map},row):map instanceof Object?this.defaultMap(map,row):row},Mapper.prototype.defaultMap=function(map,row){var instance,Class,mapping;if(Class=map.clss||Object,mapping=map.map||{},"string"==typeof mapping&&(mapping=[mapping]),mapping instanceof Array){for(var aux={},i=0;i<mapping.length;++i){var field=mapping[i];aux[field.toLowerCase()]=field}mapping=aux}instance=Object.create(Class.prototype);for(var key in row)instance[mapping[key]||key]=row[key];return instance},Mapper.prototype.customMap=function(map,row){return map(row)},Query.prototype.getTableOf=function(column){var res;if(this.source.hasColumn(column))res=this.source;else for(var i=0;i<this.joins.length;++i){var tgt=this.joins[i].target;if(tgt.hasColumn(column)){res=tgt;break}}return res},Query.prototype.filter=function(where,callback){if(!where)throw new Error("Filter expected.");return this.filterBy=where,callback&&this.find(callback),this},Query.prototype.limit=function(count,start,callback){if(2==arguments.length&&arguments[1]instanceof Function&&(callback=arguments[1],start=void 0),!count)throw new Error("Count expected.");return(void 0===start||null===start)&&(start=0),this.limitTo.count=count,this.limitTo.start=start,callback&&this.find(callback),this},Query.prototype.hasLimit=function(){return this.limitTo.count>0||this.limitTo.start>0},Query.prototype.sort=function(columns,callback){var cols={};if(!columns)throw new Error("Ordering column(s) expected.");if("string"==typeof columns)cols[columns]="ASC";else if(columns instanceof Array){if(0===columns.length)throw new Error("Ordering column(s) expected.");for(var i=0;i<columns.length;++i)cols[columns[i]]="ASC"}else{if("object"!=typeof columns)throw new Error("Ordering column(s) expected.");if(0===Object.keys(columns).length)throw new Error("Ordering column(s) expected.");cols=columns}return this.orderBy=cols,callback&&this.find(callback),this},Query.prototype.hasOrderBy=function(){return this.orderBy&&Object.keys(this.orderBy).length>0},Query.prototype.group=function(columns,callback){if(!columns)throw new Error("Grouping column name(s) expected.");return this.groupBy=new GroupBy(columns),callback&&this.find(callback),this},Query.prototype.hasGroupBy=function(){return!!this.groupBy},Query.prototype.sum=function(column,alias,filter,callback){if(2==arguments.length?arguments[1]instanceof Function?(callback=arguments[1],alias=filter=void 0):"object"==typeof arguments[1]&&(filter=arguments[1],alias=callback=void 0):3==arguments.length&&("string"==typeof arguments[1]?arguments[2]instanceof Function&&(callback=arguments[2],filter=void 0):"object"==typeof arguments[1]&&(callback=arguments[2],filter=arguments[1],alias=void 0)),!this.hasGroupBy())throw new Error("No grouping column specified.");if(!column)throw new Error("Column name expected.");return alias||(alias="sum"),this.groupBy.add(new AggOperation("sum",column,alias,filter)),callback&&this.find(callback),this},Query.prototype.count=function(column,alias,filter,callback){if(1==arguments.length?arguments[0]instanceof Function?(callback=arguments[0],column=alias=filter=void 0):"object"==typeof arguments[0]&&(filter=arguments[0],column=alias=callback=void 0):2==arguments.length?"object"==typeof arguments[0]?(filter=arguments[0],callback=arguments[1],column=alias=void 0):arguments[1]instanceof Function?(callback=arguments[1],alias=filter=void 0):"object"==typeof arguments[1]&&(filter=arguments[1],alias=callback=void 0):3==arguments.length&&("string"==typeof arguments[1]?arguments[2]instanceof Function&&(callback=arguments[2],filter=void 0):"object"==typeof arguments[1]&&(callback=arguments[2],filter=arguments[1],alias=void 0)),!this.hasGroupBy())throw new Error("No grouping column specified.");return column||(column="*"),alias||(alias="count"),this.groupBy.add(new AggOperation("count",column,alias,filter)),callback&&this.find(callback),this},Query.prototype.max=function(column,alias,filter,callback){if(2==arguments.length?arguments[1]instanceof Function?(callback=arguments[1],alias=filter=void 0):"object"==typeof arguments[1]&&(filter=arguments[1],alias=callback=void 0):3==arguments.length&&("string"==typeof arguments[1]?arguments[2]instanceof Function&&(callback=arguments[2],filter=void 0):"object"==typeof arguments[1]&&(callback=arguments[2],filter=arguments[1],alias=void 0)),!this.hasGroupBy())throw new Error("No grouping column specified.");if(!column)throw new Error("Column name expected.");return alias||(alias="max"),this.groupBy.add(new AggOperation("max",column,alias,filter)),callback&&this.find(callback),this},Query.prototype.min=function(column,alias,filter,callback){if(2==arguments.length?arguments[1]instanceof Function?(callback=arguments[1],alias=filter=void 0):"object"==typeof arguments[1]&&(filter=arguments[1],alias=callback=void 0):3==arguments.length&&("string"==typeof arguments[1]?arguments[2]instanceof Function&&(callback=arguments[2],filter=void 0):"object"==typeof arguments[1]&&(callback=arguments[2],filter=arguments[1],alias=void 0)),!this.hasGroupBy())throw new Error("No grouping column specified.");if(!column)throw new Error("Column name expected.");return alias||(alias="min"),this.groupBy.add(new AggOperation("min",column,alias,filter)),callback&&this.find(callback),this},Query.prototype.avg=function(column,alias,filter,callback){if(2==arguments.length?arguments[1]instanceof Function?(callback=arguments[1],alias=filter=void 0):"object"==typeof arguments[1]&&(filter=arguments[1],alias=callback=void 0):3==arguments.length&&("string"==typeof arguments[1]?arguments[2]instanceof Function&&(callback=arguments[2],filter=void 0):"object"==typeof arguments[1]&&(callback=arguments[2],filter=arguments[1],alias=void 0)),!this.hasGroupBy())throw new Error("No grouping column specified.");if(!column)throw new Error("Column name expected.");return alias||(alias="avg"),this.groupBy.add(new AggOperation("avg",column,alias,filter)),callback&&this.find(callback),this},Query.prototype.find=function(){throw new Error("Abstract method.")},Query.prototype.map=function(map,filter,callback){if(2==arguments.length&&arguments[1]instanceof Function&&(callback=arguments[1],filter=void 0),!map)throw new Error("Map expected.");if(!callback)throw new Error("Callback expected.");this.find(filter,function(error,result){error?callback(error):(vdba.Mapper.mapper.map(map,result.rows),callback(void 0,result))})},Query.prototype.findAll=function(callback){if(!callback)throw new Error("Callback expected.");this.filterBy={},this.find(callback)},Query.prototype.mapAll=function(map,callback){if(!map)throw new Error("Map expected.");if(!callback)throw new Error("Callback expected.");this.findAll(function(error,result){error?callback(error):(vdba.Mapper.mapper.map(map,result.rows),callback(void 0,result))})},Query.prototype.findOne=function(filter,callback){if(1==arguments.length&&arguments[0]instanceof Function&&(callback=arguments[0],filter=void 0),!callback)throw new Error("Callback expected.");filter&&(this.filterBy=filter),this.limitTo.count=1,this.find(function(error,result){error?callback(error):0===result.length?callback():callback(void 0,result.rows[0])})},Query.prototype.mapOne=function(map,filter,callback){if(2==arguments.length&&arguments[1]instanceof Function&&(callback=arguments[1],filter=void 0),!map)throw new Error("Map expected.");if(!callback)throw new Error("Callback expected.");this.findOne(filter,function(error,row){error?callback(error):row?callback(void 0,vdba.Mapper.mapper.mapRow(map,row)):callback()})},Query.prototype.join=function(target,col1,col2,callback){if(3==arguments.length&&arguments[2]instanceof Function&&(callback=arguments[2],col2=void 0),!target)throw new Error("Target table expected.");if(!col1)throw new Error("Source column name expected.");return col2||(col2=col1),this.joins.push(new vdba.Join("inner","none",target,col1,col2)),callback&&this.find(callback),this},Query.prototype.joinoo=function(target,col1,col2,callback){if(3==arguments.length&&arguments[2]instanceof Function&&(callback=arguments[2],col2=void 0),!target)throw new Error("Target table expected.");if(!col1)throw new Error("Source column name expected.");return col2||(col2=col1),this.joins.push(new vdba.Join("inner","1-1",target,col1,col2)),callback&&this.find(callback),this},Query.prototype.joinom=function(target,col1,col2,callback){if(3==arguments.length&&arguments[2]instanceof Function&&(callback=arguments[2],col2=void 0),!target)throw new Error("Target table expected.");if(!col1)throw new Error("Source column name expected.");return col2||(col2=col1),this.joins.push(new vdba.Join("inner","1-*",target,col1,col2)),callback&&this.find(callback),this},Query.prototype.isAggregate=function(){return!!this.groupBy},Query.prototype.isMultiTable=function(){return this.joins.length>0},Query.prototype.isSimple=function(){return!this.isMultiTable()},Result.prototype.__defineGetter__("length",function(){return this.rows.length}),Result.prototype.find=function(where){return vdba.Filter.filter.filter(this.rows,where),this},Result.prototype.map=function(map,where){return vdba.Mapper.mapper.map(map,this.find(where)),this},Result.prototype.limit=function(count,start){if(void 0===count||null===count)throw new Error("Count expected.");(void 0===start||null===start)&&(start=0),this.rows.slice(start,count)},Schema.prototype.isDefault=function(){throw new Error("Abstract method.")},Schema.prototype.findTable=function(){this.database.findTable.apply(this.database,[this.name].concat(Array.prototype.slice.call(arguments)))},Schema.prototype.hasTable=function(){this.database.hasTable.apply(this.database,[this.name].concat(Array.prototype.slice.call(arguments)))},Schema.prototype.hasTables=function(){this.database.hasTables.apply(this.database,[this.name].concat(Array.prototype.slice.call(arguments)))},Schema.prototype.createTable=function(){this.database.createTable.apply(this.database,[this.name].concat(Array.prototype.slice.call(arguments)))},Schema.prototype.dropTable=function(){this.database.dropTable.apply(this.database,[this.name].concat(Array.prototype.slice.call(arguments)))},Server.prototype.__defineGetter__("host",function(){throw new Error("Abstract method.")}),Server.prototype.__defineGetter__("port",function(){throw new Error("Abstract method.")}),Server.prototype.hasDatabase=function(){throw new Error("Abstract method.")},Server.prototype.__defineGetter__("version",function(){throw new Error("Abstract method.")}),Server.prototype.createDatabase=function(){throw new Error("Abstract method.")},Server.prototype.dropDatabase=function(){throw new Error("Abstract method.")},Table.prototype.__defineGetter__("columnNames",function(){return Object.keys(this.columns)}),Table.prototype.hasColumn=function(name){return this.columns.hasOwnProperty(name)},Table.prototype.__defineGetter__("database",function(){return this.schema.database}),Table.prototype.__defineGetter__("qualifiedName",function(){return(this.schema.isDefault()?"":this.schema.name+".")+this.name}),Table.prototype.__defineGetter__("qn",function(){return this.qualifiedName}),Table.prototype.__defineGetter__("fullQualifiedName",function(){return this.database.name+"."+this.qualifiedName}),Table.prototype.__defineGetter__("fqn",function(){return this.fullQualifiedName}),Table.prototype.checkSchema=function(columns){var res;columns||(columns={}),res=!0;for(var i=0,colNames=Object.keys(columns);i<colNames.length;++i){var name=colNames[i],chkCol=columns[name],tblCol=this.columns[name];if("object"!=typeof chkCol&&(chkCol={type:chkCol}),chkCol&&tblCol?(chkCol.hasOwnProperty("type")&&chkCol.type!=tblCol.type&&(res=!1),chkCol.hasOwnProperty("nullable")&&chkCol.nullable!=tblCol.nullable&&(res=!1),chkCol.hasOwnProperty("primaryKey")&&chkCol.primaryKey!=tblCol.primaryKey&&(res=!1),chkCol.hasOwnProperty("pk")&&chkCol.pk!=tblCol.primaryKey&&(res=!1)):res=!1,!res)break}return res},Table.prototype.hasIndex=function(){this.database.hasIndex.apply(this.database,[this.schema.name].concat(Array.prototype.slice.call(arguments)))},Table.prototype.findIndex=function(){this.database.findIndex.apply(this.database,[this.schema.name].concat(Array.prototype.slice.call(arguments)))},Table.prototype.createIndex=function(){this.database.createIndex.apply(this.database,[this.schema.name,this.name].concat(Array.prototype.slice.call(arguments)))},Table.prototype.dropIndex=function(name,callback){this.database.dropIndex(this.schema.name,name,callback)},Table.prototype.query=function(){throw new Error("Abstract method.")},Table.prototype.group=function(){var q=this.query();return q.group.apply(q,Array.prototype.slice.call(arguments))},Table.prototype.limit=function(){var q=this.query();return q.limit.apply(q,Array.prototype.slice.call(arguments))},Table.prototype.filter=function(){var q=this.query();return q.filter.apply(q,Array.prototype.slice.call(arguments))},Table.prototype.find=function(){var q=this.query();return q.find.apply(q,Array.prototype.slice.call(arguments))},Table.prototype.map=function(){var q=this.query();return q.map.apply(q,Array.prototype.slice.call(arguments))},Table.prototype.findAll=function(){var q=this.query();return q.findAll.apply(q,Array.prototype.slice.call(arguments))},Table.prototype.mapAll=function(){var q=this.query();return q.mapAll.apply(q,Array.prototype.slice.call(arguments))},Table.prototype.findOne=function(){var q=this.query();return q.findOne.apply(q,Array.prototype.slice.call(arguments))},Table.prototype.mapOne=function(){var q=this.query();return q.mapOne.apply(q,Array.prototype.slice.call(arguments))},Table.prototype.count=function(){throw new Error("Abstract method.")},Table.prototype.join=function(){var q=this.query();return q.join.apply(q,Array.prototype.slice.call(arguments))},Table.prototype.joinoo=function(){var q=this.query();return q.joinoo.apply(q,Array.prototype.slice.call(arguments))},Table.prototype.joinom=function(){var q=this.query();return q.joinom.apply(q,Array.prototype.slice.call(arguments))},Table.prototype.insert=function(){throw new Error("Abstract method.")},Table.prototype.save=function(){throw new Error("Abstract method.")},Table.prototype.update=function(){throw new Error("Abstract method.")},Table.prototype.remove=function(){throw new Error("Abstract method.")},Table.prototype.truncate=function(){throw new Error("Abstract method.")},Object.defineProperty(window,"vdba",{value:{},enumerable:!0}),Object.defineProperty(vdba,"util",{value:{inherits:function(child,parent){child.super_=parent,child.prototype=Object.create(parent.prototype,{constructor:{value:child,enumerable:!1,writable:!0,configurable:!0}})},_extend:function(origin,add){if("object"==typeof add)for(var i=0,keys=Object.keys(add);i<keys.length;++i){var k=keys[i];origin[k]=add[k]}return origin},getBrowserName:function(){return window.chrome?"Chrome":"Other"}}}),Object.defineProperty(vdba,"AggOperation",{value:AggOperation,enumerable:!1}),Object.defineProperty(vdba,"Aggregator",{value:Aggregator,enumerable:!0}),Object.defineProperty(vdba,"Column",{value:Column,enumerable:!0}),Object.defineProperty(vdba,"Combinator",{value:Combinator,enumerable:!0}),Object.defineProperty(vdba,"Connection",{value:Connection,enumerable:!0}),Object.defineProperty(vdba,"Database",{value:Database,enumerable:!0}),Object.defineProperty(vdba,"DefinitionCache",{value:DefinitionCache,enumerable:!1}),Object.defineProperty(vdba,"Driver",{value:Driver,enumerable:!0}),Object.defineProperty(vdba,"Filter",{value:Filter,enumerable:!0}),Object.defineProperty(vdba,"GroupBy",{value:GroupBy,enumerable:!0}),Object.defineProperty(vdba,"Index",{value:Index,enumerable:!0}),Object.defineProperty(vdba,"Join",{value:Join,enumerable:!0}),Object.defineProperty(vdba,"Mapper",{value:Mapper,enumerable:!0}),Object.defineProperty(vdba,"Query",{value:Query,enumerable:!0}),Object.defineProperty(vdba,"Result",{value:Result,enumerable:!0}),Object.defineProperty(vdba,"Schema",{value:Schema,enumerable:!0}),Object.defineProperty(vdba,"Server",{value:Server,enumerable:!0}),Object.defineProperty(vdba,"Table",{value:Table,enumerable:!0})
}();